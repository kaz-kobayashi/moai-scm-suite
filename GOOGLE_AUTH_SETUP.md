# Google認証セットアップガイド

このアプリケーションはGoogle認証を使用してユーザーアクセスを管理しています。以下の手順に従ってGoogle OAuth 2.0を設定してください。

## 1. Google Cloud Console での設定

### 1.1 新しいプロジェクトの作成（または既存プロジェクトを選択）
1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 新しいプロジェクトを作成するか、既存のプロジェクトを選択

### 1.2 Google+ API の有効化
1. 「APIとサービス」→「ライブラリ」に移動
2. "Google+ API" を検索して有効化

### 1.3 OAuth 同意画面の設定
1. 「APIとサービス」→「OAuth同意画面」に移動
2. 「外部」を選択（組織内ユーザーのみの場合は「内部」）
3. 必要な情報を入力：
   - アプリ名: `SCMOpt Supply Chain Management`
   - ユーザーサポートメール: あなたのメールアドレス
   - 開発者の連絡先情報: あなたのメールアドレス
4. スコープの設定：
   - `../auth/userinfo.email`
   - `../auth/userinfo.profile`
   - `openid`

### 1.4 OAuth 2.0 クライアント ID の作成
1. 「APIとサービス」→「認証情報」に移動
2. 「認証情報を作成」→「OAuth 2.0 クライアント ID」をクリック
3. アプリケーションの種類: 「ウェブアプリケーション」
4. 名前: `SCMOpt Web Client`
5. 承認済みの JavaScript 生成元を追加:
   - `http://localhost:3000` （開発環境）
   - `https://yourdomain.com` （本番環境のドメイン）
6. 承認済みのリダイレクト URI を追加:
   - `http://localhost:3000` （開発環境）
   - `https://yourdomain.com` （本番環境のドメイン）

### 1.5 クライアント ID をコピー
作成されたクライアント ID をコピーして保存してください。

## 2. アプリケーションの設定

### 2.1 環境変数の設定

#### 開発環境
`frontend/.env.local` ファイルを作成：

```bash
REACT_APP_GOOGLE_CLIENT_ID=あなたのGoogleクライアントID
```

#### 本番環境
本番環境のホスティングサービスで以下の環境変数を設定：

```bash
REACT_APP_GOOGLE_CLIENT_ID=あなたのGoogleクライアントID
```

### 2.2 コード内での直接設定（テスト用のみ）
テスト目的の場合、`frontend/src/App.tsx` の以下の行を直接編集：

```typescript
const GOOGLE_CLIENT_ID = "あなたのGoogleクライアントID";
```

**重要**: 本番環境では環境変数を使用してください。

## 3. デプロイ時の設定

### 3.1 ドメインの更新
本番環境にデプロイする際は、Google Cloud Console で以下を更新：

1. OAuth 2.0 クライアント ID の編集
2. 承認済みの JavaScript 生成元に本番ドメインを追加
3. 承認済みのリダイレクト URI に本番ドメインを追加

例:
- `https://your-app.vercel.app`
- `https://your-domain.com`

### 3.2 HTTPS の確保
Google OAuth は HTTPS が必要です（localhost以外）。本番環境では必ずHTTPSを使用してください。

## 4. トラブルシューティング

### よくある問題

1. **「このアプリはGoogleで確認されていません」**
   - OAuth同意画面の設定が不完全
   - テスト環境では "Continue" をクリックして進行可能

2. **「redirect_uri_mismatch」エラー**
   - Google Cloud Console で承認済みURIが正しく設定されていない
   - 現在のURLが承認済みリストに含まれていない

3. **「invalid_client」エラー**
   - クライアント ID が間違っている
   - 環境変数が正しく設定されていない

4. **ログイン画面が表示されない**
   - クライアント ID が設定されていない
   - ネットワークエラーまたはAPIが有効化されていない

### デバッグ方法

1. ブラウザの開発者ツールでコンソールエラーを確認
2. ネットワークタブで認証リクエストを確認
3. 環境変数が正しく読み込まれているか確認

## 5. セキュリティ考慮事項

1. **クライアント ID の管理**
   - クライアント IDは公開情報として扱う
   - クライアント シークレットは絶対に公開しない（SPAでは使用しない）

2. **ドメイン制限**
   - 承認済みドメインを必要最小限に制限
   - 定期的にアクセスログを確認

3. **ユーザーデータの取り扱い**
   - 必要最小限のスコープのみ要求
   - ユーザーデータの適切な管理とプライバシー保護

## 6. 本番運用

1. **監視とログ**
   - Google Cloud Console でAPIの使用状況を監視
   - 認証エラーのアラート設定

2. **バックアップ**
   - OAuth設定のバックアップ
   - クライアント IDの安全な保管

3. **更新とメンテナンス**
   - 定期的なセキュリティ更新
   - Google OAuth ポリシーの変更確認